<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Sudoku Game</title>
		<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
		<style>
			.cell-input {
				width: 100%;
				height: 100%;
				text-align: center;
				font-size: 1.25rem;
				border: none;
				outline: none;
				background: transparent;
			}
			.cell-input:disabled {
				color: #1a202c;
				font-weight: bold;
			}
			.prefilled {
				color: #1a202c;
				font-weight: bold;
			}
			.user-input {
				color: #4299e1;
			}
			.error {
				background-color: rgba(254, 202, 202, 0.5);
			}
			@media (min-width: 768px) {
				.cell-input {
					font-size: 1.5rem;
				}
			}
		</style>
	</head>
	<body class="bg-gray-100 min-h-screen">
		<div class="container mx-auto px-4 py-8">
			<h1 class="text-3xl font-bold text-center mb-6">Sudoku</h1>

			<!-- Tab Navigation -->
			<div class="flex mb-6 border-b border-gray-200">
				<button
					id="play-tab"
					class="px-4 py-2 font-medium text-sm text-blue-600 border-b-2 border-blue-600"
				>
					Play Game
				</button>
				<button
					id="manage-tab"
					class="px-4 py-2 font-medium text-sm text-gray-500 hover:text-gray-700"
				>
					Manage Boards
				</button>
			</div>

			<!-- Play Game View -->
			<div id="play-view" class="block">
				<div class="bg-white rounded-lg shadow-lg p-4 mb-6">
					<div class="flex flex-wrap justify-between items-center mb-4">
						<div class="flex space-x-2 mb-2 sm:mb-0">
							<button
								id="new-easy"
								class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm"
							>
								Easy
							</button>
							<button
								id="new-medium"
								class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm"
							>
								Medium
							</button>
							<button
								id="new-hard"
								class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm"
							>
								Hard
							</button>
						</div>
						<div class="flex space-x-2">
							<button
								id="clear-board"
								class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm"
							>
								Clear
							</button>
							<button
								id="solve-game"
								class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
							>
								Solve
							</button>
							<button
								id="check-solution"
								class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm"
							>
								Check
							</button>
						</div>
					</div>

					<!-- Game Board -->
					<div
						id="game-board"
						class="w-full max-w-md mx-auto border-2 border-gray-800"
					>
						<!-- Board will be generated by JavaScript -->
					</div>

					<!-- Status Message -->
					<div id="status-message" class="mt-4 text-center font-medium"></div>
				</div>
			</div>

			<!-- Manage Boards View -->
			<div id="manage-view" class="hidden">
				<div class="bg-white rounded-lg shadow-lg p-4 mb-6">
					<h2 class="text-xl font-semibold mb-4">Manage Sudoku Boards</h2>

					<!-- Board Management Options -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
						<div class="p-4 border rounded-lg">
							<h3 class="font-medium mb-2">Export Current Board</h3>
							<button
								id="export-board"
								class="w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded"
							>
								Export to JSON
							</button>
							<div class="mt-3">
								<textarea
									id="export-output"
									class="w-full h-32 p-2 border rounded text-xs font-mono"
									placeholder="Exported board will appear here"
									readonly
								></textarea>
							</div>
						</div>

						<div class="p-4 border rounded-lg">
							<h3 class="font-medium mb-2">Import Board</h3>
							<textarea
								id="import-input"
								class="w-full h-32 p-2 border rounded text-xs font-mono mb-3"
								placeholder="Paste JSON or 9x9 array here"
							></textarea>
							<div class="flex space-x-2">
								<button
									id="import-json"
									class="flex-1 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm"
								>
									Import JSON
								</button>
								<button
									id="import-array"
									class="flex-1 bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded text-sm"
								>
									Import Array
								</button>
							</div>
						</div>
					</div>

					<!-- Manual Editor -->
					<div class="p-4 border rounded-lg">
						<h3 class="font-medium mb-2">Manual Board Editor</h3>
						<p class="text-sm text-gray-600 mb-3">
							Click on cells to toggle between empty, prefilled, and user input
							states.
						</p>

						<div
							id="edit-board"
							class="w-full max-w-md mx-auto border-2 border-gray-800 mb-4"
						>
							<!-- Edit board will be generated by JavaScript -->
						</div>

						<div class="flex justify-between">
							<button
								id="clear-editor"
								class="bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded"
							>
								Clear Editor
							</button>
							<button
								id="apply-editor"
								class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded"
							>
								Apply to Game
							</button>
						</div>
					</div>

					<!-- Steganography Management -->
					<div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
						<!-- Encoder Section -->
						<div class="bg-white border rounded-lg p-6">
							<h2 class="text-2xl font-bold mb-4">Encoder</h2>

							<div class="mb-4">
								<label
									for="secret-text"
									class="block text-sm font-medium text-gray-700 mb-1"
									>Secret Text</label
								>
								<textarea
									id="secret-text"
									class="w-full px-3 py-2 border border-gray-300 rounded-md"
									rows="3"
									placeholder="Enter the secret message you want to hide..."
								></textarea>
							</div>

							<div class="mb-4">
								<label
									for="cover-text"
									class="block text-sm font-medium text-gray-700 mb-1"
									>Cover Text</label
								>
								<textarea
									id="cover-text"
									class="w-full px-3 py-2 border border-gray-300 rounded-md"
									rows="6"
									placeholder="Enter the cover text that will hide your message..."
								></textarea>
							</div>

							<button
								id="encode-btn"
								class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
							>
								Encode Message
							</button>

							<div id="stego-key-container" class="mt-4 hidden">
								<h3 class="text-lg font-semibold text-gray-700 mb-2">
									Generated Stego Key (Sudoku Puzzle)
								</h3>
								<pre
									id="stego-key-output"
									class="bg-gray-100 p-4 rounded-md overflow-x-auto"
								></pre>
							</div>
						</div>

						<!-- Decoder Section -->
						<div class="bg-white rounded-lg border p-6">
							<h2 class="text-2xl font-bold mb-4">Decoder</h2>

							<div class="mb-4">
								<label
									for="decoder-cover-text"
									class="block text-sm font-medium text-gray-700 mb-1"
									>Cover Text</label
								>
								<textarea
									id="decoder-cover-text"
									class="w-full px-3 py-2 border border-gray-300 rounded-md"
									rows="6"
									placeholder="Enter the same cover text used during encoding..."
								></textarea>
							</div>

							<div class="mb-4">
								<label
									for="decoder-stego-key"
									class="block text-sm font-medium text-gray-700 mb-1"
									>Stego Key (Sudoku Puzzle)</label
								>
								<textarea
									id="decoder-stego-key"
									class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono"
									rows="5"
									placeholder="Enter the stego key generated during encoding..."
								></textarea>
							</div>

							<button
								id="decode-btn"
								class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"
							>
								Decode Message
							</button>

							<div id="decoded-message-container" class="mt-4 hidden">
								<h3 class="text-lg font-semibold text-gray-700 mb-2">
									Decoded Secret Message
								</h3>
								<div
									id="decoded-message"
									class="bg-gray-100 p-4 rounded-md overflow-x-auto"
								></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="sudoku.js"></script>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				// Initialize game instance
				const game = new SudokuGame();
				let currentEditMode = "empty"; // empty, prefilled, user

				// Tab navigation
				const playTab = document.getElementById("play-tab");
				const manageTab = document.getElementById("manage-tab");
				const playView = document.getElementById("play-view");
				const manageView = document.getElementById("manage-view");

				playTab.addEventListener("click", () => {
					playTab.classList.add(
						"text-blue-600",
						"border-b-2",
						"border-blue-600"
					);
					playTab.classList.remove("text-gray-500");
					manageTab.classList.remove(
						"text-blue-600",
						"border-b-2",
						"border-blue-600"
					);
					manageTab.classList.add("text-gray-500");
					playView.classList.remove("hidden");
					playView.classList.add("block");
					manageView.classList.add("hidden");
					refreshGameBoard();
				});

				manageTab.addEventListener("click", () => {
					manageTab.classList.add(
						"text-blue-600",
						"border-b-2",
						"border-blue-600"
					);
					manageTab.classList.remove("text-gray-500");
					playTab.classList.remove(
						"text-blue-600",
						"border-b-2",
						"border-blue-600"
					);
					playTab.classList.add("text-gray-500");
					manageView.classList.remove("hidden");
					manageView.classList.add("block");
					playView.classList.add("hidden");
					refreshEditBoard();
				});

				// Generate initial game
				game.newGame("easy");

				// Game board generation function
				function generateGameBoard() {
					const gameBoard = document.getElementById("game-board");
					gameBoard.innerHTML = "";

					for (let row = 0; row < 9; row++) {
						for (let col = 0; col < 9; col++) {
							const cell = document.createElement("div");
							cell.className = "relative";

							// Add borders for visual separation of 3x3 grids
							if (row !== 8) {
								if ((row + 1) % 3 === 0 && row !== 0) {
									cell.classList.add("border-b-2", "border-t-gray-800");
								} else {
									cell.classList.add("border-b", "border-gray-300");
								}
							}

							if (col !== 9) {
								if (col + 1 === 4 || col + 1 === 7) {
									cell.classList.add("border-l-2", "border-l-gray-800");
								} else {
									cell.classList.add("border-l", "border-l-gray-300");
								}
							}

							const input = document.createElement("input");
							input.type = "number";
							input.min = 1;
							input.max = 9;
							input.className =
								"cell-input [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none";
							input.dataset.row = row;
							input.dataset.col = col;

							if (game.prefilled[row][col]) {
								input.value = game.board[row][col] || "";
								input.disabled = true;
								input.classList.add("prefilled");
							} else {
								input.value = game.board[row][col] || "";
								input.classList.add("user-input");
							}

							input.addEventListener("input", function () {
								const r = parseInt(this.dataset.row);
								const c = parseInt(this.dataset.col);
								const val = this.value ? parseInt(this.value) : 0;

								// Validate input range
								if (val < 0 || val > 9) {
									this.value = "";
									game.updateCell(r, c, 0);
								} else {
									this.value = val || "";
									game.updateCell(r, c, val);
									this.classList.remove("error");
								}
							});

							cell.appendChild(input);
							gameBoard.appendChild(cell);
						}
					}

					// Set grid layout
					gameBoard.style.display = "grid";
					gameBoard.style.gridTemplateColumns = "repeat(9, 1fr)";
					gameBoard.style.gridTemplateRows = "repeat(9, 1fr)";
					gameBoard.style.aspectRatio = "1 / 1";
				}

				// Generate edit board function
				function generateEditBoard() {
					const editBoard = document.getElementById("edit-board");
					editBoard.innerHTML = "";

					for (let row = 0; row < 9; row++) {
						for (let col = 0; col < 9; col++) {
							const cell = document.createElement("div");
							cell.className = "edit-cell relative";

							// Add borders for visual separation of 3x3 grids
							if (row !== 8) {
								if ((row + 1) % 3 === 0 && row !== 0) {
									cell.classList.add("border-b-2", "border-t-gray-800");
								} else {
									cell.classList.add("border-b", "border-gray-300");
								}
							}

							if (col !== 9) {
								if (col + 1 === 4 || col + 1 === 7) {
									cell.classList.add("border-l-2", "border-l-gray-800");
								} else {
									cell.classList.add("border-l", "border-l-gray-300");
								}
							}

							const input = document.createElement("input");
							input.type = "number";
							input.min = 1;
							input.max = 9;
							input.className =
								"cell-input [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none";
							input.dataset.row = row;
							input.dataset.col = col;

							if (game.prefilled[row][col]) {
								input.value = game.board[row][col] || "";
								input.classList.add("prefilled");
							} else if (game.board[row][col] !== 0) {
								input.value = game.board[row][col] || "";
								input.classList.add("user-input");
							}

							input.addEventListener("input", function () {
								const val = this.value ? parseInt(this.value) : 0;
								if (val < 0 || val > 9) {
									this.value = "";
								} else {
									this.value = val || "";
								}
							});

							// Click to toggle cell type
							cell.addEventListener("click", function (e) {
								if (e.target === input && e.target.tagName === "INPUT") {
									// Let the input handle its own clicks
									return;
								}

								const r = parseInt(input.dataset.row);
								const c = parseInt(input.dataset.col);

								if (
									!input.classList.contains("prefilled") &&
									!input.classList.contains("user-input")
								) {
									// Empty -> Prefilled
									input.classList.add("prefilled");
								} else if (input.classList.contains("prefilled")) {
									// Prefilled -> User input
									input.classList.remove("prefilled");
									input.classList.add("user-input");
								} else {
									// User input -> Empty
									input.classList.remove("user-input");
									input.value = "";
								}
							});

							cell.appendChild(input);
							editBoard.appendChild(cell);
						}
					}

					// Set grid layout
					editBoard.style.display = "grid";
					editBoard.style.gridTemplateColumns = "repeat(9, 1fr)";
					editBoard.style.gridTemplateRows = "repeat(9, 1fr)";
					editBoard.style.aspectRatio = "1 / 1";
				}

				// Refresh game board display
				function refreshGameBoard() {
					const gameBoard = document.getElementById("game-board");
					const inputs = gameBoard.querySelectorAll("input");

					inputs.forEach((input) => {
						const row = parseInt(input.dataset.row);
						const col = parseInt(input.dataset.col);

						input.value = game.board[row][col] || "";

						if (game.prefilled[row][col]) {
							input.disabled = true;
							input.classList.add("prefilled");
							input.classList.remove("user-input", "error");
						} else {
							input.disabled = false;
							input.classList.remove("prefilled", "error");
							if (game.board[row][col] !== 0) {
								input.classList.add("user-input");
							}
						}
					});

					// Clear status message
					document.getElementById("status-message").textContent = "";
				}

				// Refresh edit board display
				function refreshEditBoard() {
					const editBoard = document.getElementById("edit-board");
					const inputs = editBoard.querySelectorAll("input");

					inputs.forEach((input) => {
						const row = parseInt(input.dataset.row);
						const col = parseInt(input.dataset.col);

						input.value = game.board[row][col] || "";
						input.classList.remove("prefilled", "user-input");

						if (game.prefilled[row][col]) {
							input.classList.add("prefilled");
						} else if (game.board[row][col] !== 0) {
							input.classList.add("user-input");
						}
					});
				}

				// Initialize boards
				generateGameBoard();
				generateEditBoard();

				// Event Listeners for Play View
				document.getElementById("new-easy").addEventListener("click", () => {
					game.newGame("easy");
					refreshGameBoard();
				});

				document.getElementById("new-medium").addEventListener("click", () => {
					game.newGame("medium");
					refreshGameBoard();
				});

				document.getElementById("new-hard").addEventListener("click", () => {
					game.newGame("hard");
					refreshGameBoard();
				});

				document.getElementById("clear-board").addEventListener("click", () => {
					game.clearBoard();
					refreshGameBoard();
				});

				document.getElementById("solve-game").addEventListener("click", () => {
					game.solve();
					refreshGameBoard();
					document.getElementById("status-message").textContent =
						"Puzzle solved!";
					document.getElementById("status-message").className =
						"mt-4 text-center font-medium text-green-600";
				});

				document
					.getElementById("check-solution")
					.addEventListener("click", () => {
						const statusMessage = document.getElementById("status-message");
						const gameBoard = document.getElementById("game-board");
						const inputs = gameBoard.querySelectorAll("input");

						// First, check if all cells are filled
						let allFilled = true;
						inputs.forEach((input) => {
							const row = parseInt(input.dataset.row);
							const col = parseInt(input.dataset.col);

							if (game.board[row][col] === 0) {
								allFilled = false;
								input.classList.add("error");
							}
						});

						if (!allFilled) {
							statusMessage.textContent = "All cells must be filled!";
							statusMessage.className =
								"mt-4 text-center font-medium text-red-600";
							return;
						}

						// Check solution
						if (game.checkSolution()) {
							statusMessage.textContent =
								"Congratulations! Your solution is correct!";
							statusMessage.className =
								"mt-4 text-center font-medium text-green-600";
						} else {
							statusMessage.textContent =
								"Your solution is incorrect. Try again!";
							statusMessage.className =
								"mt-4 text-center font-medium text-red-600";
						}
					});

				// Event Listeners for Management View
				document
					.getElementById("export-board")
					.addEventListener("click", () => {
						const exportOutput = document.getElementById("export-output");
						exportOutput.value = game.exportBoard();
					});

				document.getElementById("import-json").addEventListener("click", () => {
					const importInput = document.getElementById("import-input");
					if (importInput.value.trim() === "") {
						alert("Please enter valid JSON data");
						return;
					}

					if (game.importBoard(importInput.value)) {
						refreshGameBoard();
						refreshEditBoard();
						alert("Board imported successfully!");
					} else {
						alert("Failed to import board. Please check the JSON format.");
					}
				});

				document
					.getElementById("import-array")
					.addEventListener("click", () => {
						const importInput = document.getElementById("import-input");
						if (importInput.value.trim() === "") {
							alert("Please enter a valid board array");
							return;
						}

						try {
							const boardArray = JSON.parse(importInput.value);
							if (game.importBoardFromArray(boardArray)) {
								refreshGameBoard();
								refreshEditBoard();
								alert("Board imported successfully!");
							} else {
								alert("Failed to import board. Please check the array format.");
							}
						} catch (error) {
							alert("Invalid JSON format: " + error.message);
						}
					});

				document
					.getElementById("clear-editor")
					.addEventListener("click", () => {
						const editBoard = document.getElementById("edit-board");
						const inputs = editBoard.querySelectorAll("input");

						inputs.forEach((input) => {
							input.value = "";
							input.classList.remove("prefilled", "user-input");
						});
					});

				document
					.getElementById("apply-editor")
					.addEventListener("click", () => {
						const editBoard = document.getElementById("edit-board");
						const inputs = editBoard.querySelectorAll("input");

						// Create a new board and prefilled array
						const newBoard = Array(9)
							.fill()
							.map(() => Array(9).fill(0));
						const newPrefilled = Array(9)
							.fill()
							.map(() => Array(9).fill(false));

						inputs.forEach((input) => {
							const row = parseInt(input.dataset.row);
							const col = parseInt(input.dataset.col);
							const val = input.value ? parseInt(input.value) : 0;

							newBoard[row][col] = val;

							if (input.classList.contains("prefilled")) {
								newPrefilled[row][col] = true;
							}
						});

						// Check if the board is valid and has a solution
						const tempGame = new SudokuGame();
						tempGame.board = JSON.parse(JSON.stringify(newBoard));
						tempGame.prefilled = JSON.parse(JSON.stringify(newPrefilled));

						// Try to solve to verify it's valid
						const solutionBoard = JSON.parse(JSON.stringify(newBoard));
						if (tempGame.solveBoard(solutionBoard)) {
							// Apply to the actual game
							game.board = newBoard;
							game.prefilled = newPrefilled;
							game.solution = solutionBoard;

							refreshGameBoard();
							alert("Board applied successfully!");
						} else {
							alert(
								"This board has no valid solution! Please fix it before applying."
							);
						}
					});
			});
		</script>
	</body>
</html>
