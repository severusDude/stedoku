<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Sudoku Steganography Demo</title>
		<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
		<script src="sudoku.js"></script>
		<script src="steganography-encoder.js"></script>
		<script src="steganography-decoder.js"></script>
	</head>
	<body class="bg-gray-100 min-h-screen p-4">
		<div class="max-w-4xl mx-auto">
			<h1 class="text-3xl font-bold text-center text-blue-800 mb-6">
				Sudoku Steganography Demo
			</h1>

			<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
				<!-- Encoder Section -->
				<div class="bg-white rounded-xl shadow-lg p-6">
					<h2 class="text-2xl font-bold text-blue-700 mb-4">Encoder</h2>

					<div class="mb-4">
						<label
							for="secret-text"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Secret Text</label
						>
						<textarea
							id="secret-text"
							class="w-full px-3 py-2 border border-gray-300 rounded-md"
							rows="3"
							placeholder="Enter the secret message you want to hide..."
						></textarea>
					</div>

					<div class="mb-4">
						<label
							for="cover-text"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Cover Text</label
						>
						<textarea
							id="cover-text"
							class="w-full px-3 py-2 border border-gray-300 rounded-md"
							rows="6"
							placeholder="Enter the cover text that will hide your message..."
						></textarea>
					</div>

					<button
						id="encode-btn"
						class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
					>
						Encode Message
					</button>

					<div id="stego-key-container" class="mt-4 hidden">
						<h3 class="text-lg font-semibold text-gray-700 mb-2">
							Generated Stego Key (Sudoku Puzzle)
						</h3>
						<pre
							id="stego-key-output"
							class="bg-gray-100 p-4 rounded-md overflow-x-auto"
						></pre>
					</div>
				</div>

				<!-- Decoder Section -->
				<div class="bg-white rounded-xl shadow-lg p-6">
					<h2 class="text-2xl font-bold text-blue-700 mb-4">Decoder</h2>

					<div class="mb-4">
						<label
							for="decoder-cover-text"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Cover Text</label
						>
						<textarea
							id="decoder-cover-text"
							class="w-full px-3 py-2 border border-gray-300 rounded-md"
							rows="6"
							placeholder="Enter the same cover text used during encoding..."
						></textarea>
					</div>

					<div class="mb-4">
						<label
							for="decoder-stego-key"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Stego Key (Sudoku Puzzle)</label
						>
						<textarea
							id="decoder-stego-key"
							class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono"
							rows="5"
							placeholder="Enter the stego key generated during encoding..."
						></textarea>
					</div>

					<button
						id="decode-btn"
						class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"
					>
						Decode Message
					</button>

					<div id="decoded-message-container" class="mt-4 hidden">
						<h3 class="text-lg font-semibold text-gray-700 mb-2">
							Decoded Secret Message
						</h3>
						<div
							id="decoded-message"
							class="bg-gray-100 p-4 rounded-md overflow-x-auto"
						></div>
					</div>
				</div>
			</div>

			<!-- Copy buttons -->
			<div class="flex justify-center mt-6 space-x-4">
				<button
					id="copy-to-decoder"
					class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded"
				>
					Copy Encoder Data to Decoder
				</button>

				<button
					id="run-example"
					class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded"
				>
					Run Example
				</button>
			</div>

			<!-- Visual representation -->
			<div class="mt-8 bg-white rounded-xl shadow-lg p-6">
				<h2 class="text-2xl font-bold text-blue-700 mb-4">
					Sudoku Representation of Stego Key
				</h2>
				<div
					id="sudoku-visualization"
					class="grid grid-cols-9 gap-0 border-2 border-gray-800 mb-6 max-w-md mx-auto"
				>
					<!-- Will be populated by JavaScript -->
				</div>
			</div>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				// Elements
				const secretTextInput = document.getElementById("secret-text");
				const coverTextInput = document.getElementById("cover-text");
				const encodeBtn = document.getElementById("encode-btn");
				const stegoKeyContainer = document.getElementById(
					"stego-key-container"
				);
				const stegoKeyOutput = document.getElementById("stego-key-output");

				const decoderCoverText = document.getElementById("decoder-cover-text");
				const decoderStegoKey = document.getElementById("decoder-stego-key");
				const decodeBtn = document.getElementById("decode-btn");
				const decodedMessageContainer = document.getElementById(
					"decoded-message-container"
				);
				const decodedMessage = document.getElementById("decoded-message");

				const copyToDecoderBtn = document.getElementById("copy-to-decoder");
				const runExampleBtn = document.getElementById("run-example");

				const sudokuVisualization = document.getElementById(
					"sudoku-visualization"
				);

				let currentStegoKey = null;

				// Encoder event
				encodeBtn.addEventListener("click", () => {
					const secretText = secretTextInput.value.trim();
					const coverText = coverTextInput.value.trim();

					if (!secretText || !coverText) {
						alert("Please enter both secret text and cover text.");
						return;
					}

					try {
						const encoder = new SteganographyEncoder();
						currentStegoKey = encoder.encode(secretText, coverText);

						// Display the stego key
						// stegoKeyOutput.textContent = encoder.formatStegoKey();
						stegoKeyContainer.classList.remove("hidden");

						// Update the Sudoku visualization
						updateSudokuVisualization(currentStegoKey);
					} catch (error) {
						alert("Error encoding: " + error.message);
						console.error(error);
					}
				});

				// Decoder event
				decodeBtn.addEventListener("click", () => {
					const coverText = decoderCoverText.value.trim();
					const stegoKeyText = decoderStegoKey.value.trim();

					if (!coverText || !stegoKeyText) {
						alert("Please enter both cover text and stego key.");
						return;
					}

					try {
						const decoder = new SteganographyDecoder();

						// Parse the stego key text to a 2D array
						const stegoKey = decoder.parseFormattedStegoKey(stegoKeyText);

						// Decode the message
						const secretText = decoder.decode(stegoKey, coverText);

						// Display the decoded message
						decodedMessage.textContent = secretText;
						decodedMessageContainer.classList.remove("hidden");

						// Update the Sudoku visualization
						updateSudokuVisualization(stegoKey);
					} catch (error) {
						alert("Error decoding: " + error.message);
						console.error(error);
					}
				});

				// Copy encoder data to decoder
				copyToDecoderBtn.addEventListener("click", () => {
					decoderCoverText.value = coverTextInput.value;
					decoderStegoKey.value = stegoKeyOutput.textContent;
				});

				// Run example
				runExampleBtn.addEventListener("click", () => {
					const exampleSecretText = "Hello, this is a secret message!";
					const exampleCoverText =
						"This is the first sentence of the cover text. Here is the second sentence with some more words. And here is a third one that contains additional text. The fourth sentence completes the example with even more words.";

					secretTextInput.value = exampleSecretText;
					coverTextInput.value = exampleCoverText;

					// Trigger the encode button
					encodeBtn.click();

					// Copy to decoder
					copyToDecoderBtn.click();

					// Trigger the decode button after a short delay
					setTimeout(() => {
						decodeBtn.click();
					}, 100);
				});

				// Function to update the Sudoku visualization
				function updateSudokuVisualization(stegoKey) {
					if (!stegoKey || stegoKey.length === 0) return;

					// Clear previous visualization
					sudokuVisualization.innerHTML = "";

					// Determine grid size based on the stegoKey
					const size = stegoKey[0].length;
					sudokuVisualization.style.gridTemplateColumns = `repeat(${size}, minmax(0, 1fr))`;

					// Create cells
					for (let row = 0; row < stegoKey.length; row++) {
						for (let col = 0; col < stegoKey[row].length; col++) {
							const cell = document.createElement("div");
							cell.className =
								"cell w-10 h-10 flex items-center justify-center border border-gray-400";

							// Add thicker borders to separate 3x3 blocks
							if (size >= 9) {
								if (col % 3 === 2 && col < size - 1) {
									cell.classList.add("border-r-2", "border-r-gray-800");
								}
								if (row % 3 === 2 && row < size - 1) {
									cell.classList.add("border-b-2", "border-b-gray-800");
								}
							}

							const value = stegoKey[row][col];

							// Different colors for different entry rounds
							let textColor = "text-gray-800";
							if (value > 0) {
								const maxWordLength = 10; // Estimate
								const entryRound = Math.ceil(value / maxWordLength);

								if (entryRound === 1) textColor = "text-blue-600";
								else if (entryRound === 2) textColor = "text-green-600";
								else if (entryRound === 3) textColor = "text-purple-600";
								else textColor = "text-red-600";
							}

							cell.innerHTML = `<span class="font-bold ${textColor}">${
								value || ""
							}</span>`;
							sudokuVisualization.appendChild(cell);
						}
					}
				}
			});
		</script>
	</body>
</html>
