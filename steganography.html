<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Sudoku Steganography</title>
		<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
		<style>
			.cell-input {
				width: 100%;
				height: 100%;
				text-align: center;
				font-size: 1.25rem;
				border: none;
				outline: none;
				background: transparent;
			}
			.cell-input:focus {
				background-color: #e5edff;
			}
			.prefilled {
				font-weight: bold;
				color: #1a365d;
			}
			.invalid {
				background-color: #fed7d7;
			}
		</style>
	</head>
	<body
		class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4"
	>
		<div class="bg-white rounded-xl shadow-lg p-6 max-w-3xl w-full">
			<h1 class="text-3xl font-bold text-center text-blue-800 mb-6">
				Sudoku Steganography
			</h1>

			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<!-- Left column: Encoding -->
				<div class="bg-blue-50 p-4 rounded-lg shadow-md">
					<h2 class="text-xl font-semibold text-blue-700 mb-3">
						Encode Message
					</h2>

					<div class="mb-4">
						<label
							for="secret-message"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Secret Message:</label
						>
						<textarea
							id="secret-message"
							class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
							rows="4"
							placeholder="Enter your secret message here..."
						></textarea>
					</div>

					<div class="mb-4">
						<label
							for="cover-text"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Cover Text:</label
						>
						<textarea
							id="cover-text"
							class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
							rows="6"
							placeholder="Enter cover text here... (longer text works better)"
						></textarea>
					</div>

					<button
						id="encode-btn"
						class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow"
					>
						Encode Message into Sudoku
					</button>
				</div>

				<!-- Right column: Decoding -->
				<div class="bg-green-50 p-4 rounded-lg shadow-md">
					<h2 class="text-xl font-semibold text-green-700 mb-3">
						Decode Message
					</h2>

					<div class="mb-4">
						<label
							for="decode-cover-text"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Cover Text:</label
						>
						<textarea
							id="decode-cover-text"
							class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
							rows="6"
							placeholder="Enter the same cover text used for encoding..."
						></textarea>
					</div>

					<div class="mb-4">
						<p class="block text-sm font-medium text-gray-700 mb-1">
							Sudoku Puzzle (automatically filled from the board below):
						</p>
						<p class="text-xs text-gray-500">
							The current board state will be used for decoding
						</p>
					</div>

					<button
						id="decode-btn"
						class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md shadow"
					>
						Decode Message from Sudoku
					</button>

					<div class="mt-4">
						<label
							for="decoded-message"
							class="block text-sm font-medium text-gray-700 mb-1"
							>Decoded Message:</label
						>
						<textarea
							id="decoded-message"
							class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50"
							rows="4"
							readonly
						></textarea>
					</div>
				</div>
			</div>

			<!-- Sudoku Board -->
			<div class="mt-8">
				<h2 class="text-xl font-semibold text-center text-gray-700 mb-4">
					Sudoku Board
				</h2>
				<div class="flex justify-center">
					<div
						id="board"
						class="grid grid-cols-9 gap-0 border-2 border-gray-800"
					>
						<!-- Board will be generated by JavaScript -->
					</div>
				</div>

				<div class="flex justify-center mt-4 space-x-4">
					<button
						id="new-game"
						class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
					>
						New Sudoku
					</button>
					<button
						id="clear"
						class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"
					>
						Clear Board
					</button>
				</div>
			</div>

			<div id="message" class="mt-6 text-center font-medium hidden"></div>
		</div>

		<script src="sudoku.js"></script>
		<script src="steganography.js"></script>
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				// Initialize the game and steganography
				const game = new SudokuGame();
				const steg = new SudokuSteganography();

				// Generate the board UI
				const boardElement = document.getElementById("board");

				for (let row = 0; row < 9; row++) {
					for (let col = 0; col < 9; col++) {
						const cell = document.createElement("div");
						cell.className =
							"cell w-10 h-10 flex items-center justify-center border border-gray-400";

						// Add thicker borders to separate 3x3 blocks
						if (col % 3 === 2 && col < 8) {
							cell.classList.add("border-r-2", "border-r-gray-800");
						}
						if (row % 3 === 2 && row < 8) {
							cell.classList.add("border-b-2", "border-b-gray-800");
						}

						const input = document.createElement("input");
						input.type = "text";
						input.maxLength = 1;
						input.dataset.row = row;
						input.dataset.col = col;
						input.className = "cell-input";

						// Allow only numbers 1-9
						input.addEventListener("input", (e) => {
							e.target.value = e.target.value.replace(/[^1-9]/g, "");
							game.updateCell(
								row,
								col,
								e.target.value ? parseInt(e.target.value) : 0
							);
						});

						// Move to next cell on keydown
						input.addEventListener("keydown", (e) => {
							if (e.key === "ArrowRight" && col < 8) {
								document
									.querySelector(`[data-row="${row}"][data-col="${col + 1}"]`)
									.focus();
							} else if (e.key === "ArrowLeft" && col > 0) {
								document
									.querySelector(`[data-row="${row}"][data-col="${col - 1}"]`)
									.focus();
							} else if (e.key === "ArrowUp" && row > 0) {
								document
									.querySelector(`[data-row="${row - 1}"][data-col="${col}"]`)
									.focus();
							} else if (e.key === "ArrowDown" && row < 8) {
								document
									.querySelector(`[data-row="${row + 1}"][data-col="${col}"]`)
									.focus();
							}
						});

						cell.appendChild(input);
						boardElement.appendChild(cell);
					}
				}

				// Function to update the UI based on the game state
				function updateBoardUI(game) {
					const cells = document.querySelectorAll(".cell-input");
					cells.forEach((cell) => {
						const row = parseInt(cell.dataset.row);
						const col = parseInt(cell.dataset.col);
						const value = game.board[row][col];

						cell.value = value !== 0 ? value : "";
						cell.classList.toggle("prefilled", game.prefilled[row][col]);
						cell.disabled = game.prefilled[row][col];
					});
				}

				// Start a new game
				game.newGame("easy");
				updateBoardUI(game);

				// Event listeners for Sudoku game buttons
				document.getElementById("new-game").addEventListener("click", () => {
					game.newGame("medium");
					updateBoardUI(game);
					document.getElementById("message").classList.add("hidden");
				});

				document.getElementById("clear").addEventListener("click", () => {
					game.clearBoard();
					updateBoardUI(game);
					document.getElementById("message").classList.add("hidden");
				});

				// Encode button functionality
				document.getElementById("encode-btn").addEventListener("click", () => {
					const secretText = document.getElementById("secret-message").value;
					const coverText = document.getElementById("cover-text").value;

					if (!secretText || !coverText) {
						const messageEl = document.getElementById("message");
						messageEl.textContent =
							"Please enter both secret message and cover text.";
						messageEl.className = "mt-6 text-center font-medium text-red-600";
						messageEl.classList.remove("hidden");
						return;
					}

					try {
						// Create a new game with the encoded message
						const stegoGame = steg.createEncodedSudokuGame(
							secretText,
							coverText
						);

						// Update the board
						game.board = stegoGame.board;
						game.prefilled = stegoGame.prefilled;
						game.solution = stegoGame.solution;

						updateBoardUI(game);

						// Copy cover text to the decode side
						document.getElementById("decode-cover-text").value = coverText;

						// Show success message
						const messageEl = document.getElementById("message");
						messageEl.textContent =
							"Secret message successfully encoded into the Sudoku puzzle!";
						messageEl.className = "mt-6 text-center font-medium text-green-600";
						messageEl.classList.remove("hidden");
					} catch (error) {
						const messageEl = document.getElementById("message");
						messageEl.textContent = "Error encoding message: " + error.message;
						messageEl.className = "mt-6 text-center font-medium text-red-600";
						messageEl.classList.remove("hidden");
					}
				});

				// Decode button functionality
				document.getElementById("decode-btn").addEventListener("click", () => {
					const coverText = document.getElementById("decode-cover-text").value;

					if (!coverText) {
						const messageEl = document.getElementById("message");
						messageEl.textContent =
							"Please enter the cover text used for encoding.";
						messageEl.className = "mt-6 text-center font-medium text-red-600";
						messageEl.classList.remove("hidden");
						return;
					}

					try {
						// Get current board state
						const boardState = game.board;

						// Decode the message
						const decodedMessage = steg.decode(boardState, coverText);

						// Display the decoded message
						document.getElementById("decoded-message").value = decodedMessage;

						// Show success message
						const messageEl = document.getElementById("message");
						messageEl.textContent = "Message successfully decoded!";
						messageEl.className = "mt-6 text-center font-medium text-green-600";
						messageEl.classList.remove("hidden");
					} catch (error) {
						const messageEl = document.getElementById("message");
						messageEl.textContent = "Error decoding message: " + error.message;
						messageEl.className = "mt-6 text-center font-medium text-red-600";
						messageEl.classList.remove("hidden");

						// Clear the decoded message area
						document.getElementById("decoded-message").value = "";
					}
				});
			});
		</script>
	</body>
</html>
